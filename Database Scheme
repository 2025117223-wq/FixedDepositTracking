CREATE TABLE Bank (
    bankID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    bankName VARCHAR2(100) NOT NULL,
    bankPhone VARCHAR2(20),
    bankAddress VARCHAR2(200),
    CONSTRAINT pk_bank PRIMARY KEY (bankID),
    CONSTRAINT uq_bank_name UNIQUE (bankName)
);

CREATE TABLE Staff (
    staffID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    staffName VARCHAR2(100) NOT NULL,
    staffPhone VARCHAR2(20) NOT NULL,
    staffAddress VARCHAR2(200) NOT NULL,
    staffEmail VARCHAR2(150) NOT NULL,
    staffRole VARCHAR2(150) NOT NULL,
    password VARCHAR2(128) NOT NULL,
    staffPicture BLOB NOT NULL,
    staffStatus VARCHAR2(50) DEFAULT 'ACTIVE',
    reason VARCHAR2(255),
    managerID NUMBER,
    CONSTRAINT pk_staff PRIMARY KEY (staffID),
    CONSTRAINT uq_staff_email UNIQUE (staffEmail),
    CONSTRAINT fk_manager FOREIGN KEY (managerID) REFERENCES Staff(staffID)
);

CREATE TABLE FixedDepositRecord (
    fdID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    certNo VARCHAR2(30),
    accNumber VARCHAR2(30) NOT NULL,
    referralNumber VARCHAR2(30),
    depositAmount NUMBER(15,2) NOT NULL CHECK (depositAmount > 0),
    interestRate NUMBER(5,3) NOT NULL CHECK (interestRate > 0),
    tenure NUMBER(5) NOT NULL CHECK (tenure > 0),
    startDate DATE NOT NULL,
    maturityDate DATE NOT NULL,
    fdCert BLOB,
    status VARCHAR2(30) DEFAULT 'ONGOING' NOT NULL CHECK (status IN ('ONGOING', 'PENDING', 'MATURED')),
    bankID NUMBER NOT NULL,
    CONSTRAINT pk_fd_record PRIMARY KEY (fdID),
    CONSTRAINT uq_fd_certno UNIQUE (certNo),
    CONSTRAINT fk_fd_bank FOREIGN KEY (bankID) REFERENCES Bank(bankID),
    CONSTRAINT chk_fd_dates CHECK (maturityDate >= startDate)
);

CREATE TABLE FreeFD (
    fdID NUMBER,
    autoRenewalStatus CHAR(1) NOT NULL CHECK (autoRenewalStatus IN ('Y', 'N')),
    withdrawableStatus CHAR(1) NOT NULL CHECK (withdrawableStatus IN ('Y', 'N')),
    CONSTRAINT pk_freefd PRIMARY KEY (fdID),
    CONSTRAINT fk_freefd_fd FOREIGN KEY (fdID) REFERENCES FixedDepositRecord(fdID)
);

CREATE TABLE PledgeFD (
    fdID NUMBER,
    collateralStatus CHAR(1) DEFAULT 'N' NOT NULL CHECK (collateralStatus IN ('Y', 'N')),
    pledgeValue NUMBER(15,2) CHECK (pledgeValue > 0),
    CONSTRAINT pk_pledgefd PRIMARY KEY (fdID),
    CONSTRAINT fk_pledgefd_fd FOREIGN KEY (fdID) REFERENCES FixedDepositRecord(fdID)
);

CREATE TABLE FixedDepositTransaction (
    transactionID NUMBER GENERATED BY DEFAULT AS IDENTITY,
    fdID NUMBER NOT NULL,
    staffID NUMBER NOT NULL,
    transactionDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    calcTotalProfit NUMBER(15,2) CHECK (calcTotalProfit IS NULL OR calcTotalProfit >= 0),
    transactionType VARCHAR2(30) NOT NULL CHECK (transactionType IN ('DEPOSIT', 'WITHDRAW')),
    withdrawAmount NUMBER(15,2) CHECK (withdrawAmount > 0),
    CONSTRAINT pk_fd_txn PRIMARY KEY (transactionID),
    CONSTRAINT fk_txn_fd FOREIGN KEY (fdID) REFERENCES FixedDepositRecord(fdID),
    CONSTRAINT fk_txn_staff FOREIGN KEY (staffID) REFERENCES Staff(staffID)
);
